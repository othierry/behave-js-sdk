"use strict";(function(e,t){if(!e.behave){var n=e.behave={};n.API_ROOT="http://api.behave.io",n.init=function(e,t){n.token=e,n.options=t||{},n.requestQueue=n.queue(function(e,t){e.params&&(e.method==="POST"||e.method==="PUT")&&(e.params=JSON.stringify(e.params)),$.ajax({url:n.API_ROOT+(typeof e.path=="function"?e.path():e.path),type:e.method||"GET",data:e.params,headers:{"X-Behave-Api-Token":n.token,"Content-Type":"application/json"}}).done(function(e,n,r){t(null,e)}).fail(function(e,n,r){t(r,null)})}),n.requestQueue.push({path:"/app/info"},n.responseHandler(function(e,t){e?console.error("Failed to fetch app info"):n.app=t}))},n.identify=function(e,t,r){r=typeof t=="function"?t:r,t=typeof t=="object"?t:{},n.player=e,n.requestQueue.push({path:"/players/"+e+"/identify",method:"POST",params:{traits:t}},n.responseHandler(r))},n.track=function(e,t,r){if(!n.player)return r("behave.identify() must be called before tracking any of the player's behaviours.");r=typeof t=="function"?t:r,t=typeof t=="object"?t:null,!r&&n.options.handlesTrackingResponse!==!1&&(r=n.displayBadgeIfNeeded),n.requestQueue.push({path:"/players/"+n.player+"/track",method:"POST",params:{verb:e,context:t}},n.responseHandler(r))},n.fetchPlayerBadges=function(e){if(!n.player)return e("behave.identify() must be called before tracking any of the player's behaviours.");n.requestQueue.push({path:"/players/"+n.player+"/track"},n.responseHandler(e))},n.fetchLeaderboardResultsForPlayer=function(e,t){if(!n.player)return t("behave.identify() must be called before tracking any of the player's behaviours.");t=typeof e=="function"?e:t,e=typeof e=="object"?e:{},e.player_id=n.player,n.requestQueue.push({path:"/leaderboards/player-results",method:"POST",params:e},n.responseHandler(t))},n.fetchLeaderboardResultForPlayer=function(e,t,r){return n.player?(r=typeof t=="function"?t:r,t=typeof t=="object"?t:{},t.leaderboards=[e],n.fetchLeaderboardResultsForPlayer(t,r)):r("behave.identify() must be called before tracking any of the player's behaviours.")},n.fetchLeaderboardResults=function(e,t,r){r=typeof t=="function"?t:r,t=typeof t=="object"?t:{},t.limit=t.limit?Math.min(1e3,t.limit):1e3,t.offset=t.page?(t.page-1)*t.limit:0,t.max&&t.max<t.limit&&(t.limit=t.max),n.requestQueue.push({path:"/leaderboards/"+e+"/results",params:t},n.responseHandler(r))},n.iterateLeaderboardResults=function(e,t,r,i){i=typeof t=="function"?r:i,r=typeof t=="function"?t:r,t=typeof t=="object"?t:{};var s=t.page||1,o=t.limit||1e3,u=t.max||0;n.fetchLeaderboardResults(e,t,function(a,f){if(f){var l=(s-1)*o+f.length,c=f.length===0;c?i&&i():(u>0&&l>u&&(f=f.slice(0,f.length-(l-u)),c=!0),r(f,s),c?i&&i():(t.page=s+1,n.iterateLeaderboardResults(e,t,r,i)))}})},n.responseHandler=function(e){return function(t,n){if(e){if(t||n.error)return e(t||n.error);e(null,n.data)}}},n.displayBadgeIfNeeded=function(e,t){t.badges.length&&n.ui({method:"dialog",badge:t.badges[0],facebook:{link:n.app.url,caption:n.app.name}})},n.queue=function(e){var t=[];return{push:function(e,n){t.push([e,n]),t.length===1&&this.run()},run:function(){if(t.length===0)return;var n=this,r=t[0];e(r[0],function(e,i){r[1]&&r[1](e,i),t=t.slice(1,t.length),n.run()})}}},n.ui=function(t){if(t.method=="dialog")return{showClass:"bounceInDown",hideClass:"bounceOutDown",facebookEnabled:t.facebook&&e.FB,compile:function(){return'<div>  <div class="modal-backdrop fade"></div>  <div style="text-align:center" class="well span5 bh-dialog">    <legend style="text-align:center">'+t.badge.name+" unlocked!</legend>"+"    <div>"+'      <img style="margin:auto;display:block" '+'           class="img img-circle img-polaroid" '+'           src="'+t.badge.icon+'" '+'           width="100px" '+'           height="100px" />'+"    </div>"+"    <br>"+"    <p>"+"      "+t.badge.message+"    </p>"+"    <hr>"+(this.facebookEnabled?'<div class="btn btn-facebook" ng-click="shareOnFacebook()"><i class="icon-facebook"></i> | Share</a></div>':"")+'    <div class="btn" ng-click="close()">'+(this.facebookEnabled?"Or close":"Close")+"</a></div>"+"  </div>"+"</div>"},open:function(){var n=this;n.el=$(n.compile()).appendTo("body"),n.el.children().eq(0).addClass("in"),n.el.children().eq(1).addClass("animated"),n.el.children().eq(1).addClass(n.showClass),n.el.children().eq(1).children().last().click(function(e){e.preventDefault(),n.close()}),n.el.children().eq(1).children().last().prev().click(function(n){e.FB.ui({method:"feed",name:t.badge.name,link:t.facebook.link||"",picture:t.badge.icon,caption:t.facebook.caption||"",description:t.badge.message})})},close:function(){var e=this;e.el.children().eq(0).removeClass("in"),e.el.children().eq(1).removeClass(e.showClass),e.el.children().eq(1).addClass(e.hideClass),setTimeout(function(){e.el.remove()},500)},isOpen:function(){return this.el!=null}}.open()}}})(window,document);